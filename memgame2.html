<!DOCTYPE HTML>
<html lang = "th-TH">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡∏Å ‡∏Ç</title>
<style>
label, #xmode {
  font-size: 20px;
}
button {
  width: 30px;
  height: 30px;
  padding: 1px 1px;
  margin: 1px 1px;
  font-size: 28px;
}
#msg {
  font-size: 24px;
  color: blue;
}

.card {
  height: 75px;
  width: 75px;
  border: 2px solid white;
  padding: 2px 2px;
  text-align: center;
  font-size: 60px; 
  color: yellow;
  margin: 2px 2px;
  display: inline-block;
  cursor: pointer;
  opacity: 0.7;
  border-radius: 25%;  
}
.card:hover {
  animation: shake 0.5s;
   animation-iteration-count: 2; 
}

@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  10% { transform: translate(-1px, -2px) rotate(-1deg); }
  20% { transform: translate(-3px, 0px) rotate(1deg); }
  30% { transform: translate(3px, 2px) rotate(0deg); }
  40% { transform: translate(1px, -1px) rotate(1deg); }
  50% { transform: translate(-1px, 2px) rotate(-1deg); }
  60% { transform: translate(-3px, 1px) rotate(0deg); }
  70% { transform: translate(3px, 1px) rotate(-1deg); }
  80% { transform: translate(-1px, -1px) rotate(1deg); }
  90% { transform: translate(1px, 2px) rotate(0deg); }
  100% { transform: translate(1px, -2px) rotate(-1deg); }
}

#board {
  width: 352px;
  height: 352px;
  background-color: #00001a;
  padding: 2px 2px; 
  margin: auto;
}

</style>
</head>
<body>
<h2>‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
<p>
 <label for="game"><b>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å..</b</label>
 <select name="game" id="xmode">
   <option value="emo" title="‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥">.üëÅÔ∏è.</option>
   <option value="‡∏Å‡∏Ç‡∏Ñ" title="‡∏•‡∏≤‡∏¢‡∏™‡∏∑‡∏≠‡πÑ‡∏ó‡∏¢">‡∏Å‡∏Ç.</option>
   <option value="‡∫Å=‡∏Å" title="‡∏•‡∏≤‡∏ß-‡πÑ‡∏ó‡∏¢">‡∫Å=‡∏Å</option>
   <option value="·®†·®°‡∏Ñ" title="‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤-‡πÑ‡∏ó‡∏¢">·®†·®°‡∏Ñ</option>
   <option value="·ûÄ=‡∏Å" title="‡∏û‡∏°‡πà‡∏≤-‡πÑ‡∏ó‡∏¢">·ûÄ=‡∏Å</option>
   <option value="·ÄÄ=‡∏Å" title="‡πÄ‡∏Ç‡∏°‡∏£-‡πÑ‡∏ó‡∏¢">·ÄÄ=‡∏Å</option>
   <option value="·®†·®°·®¢" title="‡∏ï‡∏±‡πá‡∏ß‡∏ò‡∏£‡∏£‡∏°">·®†·®°·®¢</option>
   <option value="abc" title="‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">aBC</option>
 </select> 
 <button id="btn" onclick="deal()">‚ñ∂Ô∏è</button> 
 <span id="msg"><-‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏•‡πà‡∏ô</span>
</p>
<div id="board">
</div>
<div id="pairs"></div>
<script src="script/beeper2.js" type="text/javascript"></script>
<script>
let reload = 0; // for reloading
let toid = null; // timeout id
let npairs = 0; // pairs discovered to end game
var opened = null; // card object opened
var cards = []; // save card objects
var quiz = [];  // save card query
var oix = null, cix = null; //positions in cards arrays
var xgame; // selected game
const board = document.getElementById("board");
const btn = document.getElementById("btn");
const msg = document.getElementById("msg");
const pairs = document.getElementById("pairs");
const masks = ['üî≥Ô∏è','üåÄÔ∏è','üö≠Ô∏è','üîòÔ∏è','üè°Ô∏è','üí¢Ô∏è','üßøÔ∏è'];
var mask = ""; // cover icon to be set each play
var tick = "‚úÖÔ∏è";
var query, twin; // card query and its twin arrays 

const Emos=['üöóÔ∏è','üòÄÔ∏è','üê•Ô∏è','üôèÔ∏è','ü¶ìÔ∏è','üêìÔ∏è','ü¶ñÔ∏è','üêûÔ∏è','üêëÔ∏è','ü™ëÔ∏è','ü•¨Ô∏è','ü¶∫Ô∏è','ü¶òÔ∏è','üå∂Ô∏è','üêéÔ∏è','‚öñÔ∏è',
'üêßÔ∏è','ü¶ÜÔ∏è','üïíÔ∏è','üö≤Ô∏è','üèã‚Äç‚ôÇÔ∏èÔ∏è','üö£‚Äç‚ôÄÔ∏èÔ∏è','üëÅÔ∏è','‚òÇÔ∏è','ü¶ÆÔ∏è','üêíÔ∏è','üçèÔ∏è','‚ò¢Ô∏è','ü•ïÔ∏è','ü•ëÔ∏è','üôâÔ∏è','üë©‚Äçü¶ΩÔ∏è','üåèÔ∏è'];
const Lat='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
//** Alphabets (?of the same origin) used in SouthEast Asia **//
//Thg='‡∏Å‡∏à‡∏é‡∏è‡∏î‡∏ï‡∏ö‡∏õ‡∏≠‡∏Ñ‡∏Ö‡∏Ü‡∏á‡∏ä‡∏ã‡∏å‡∏ç‡∏ë‡∏í‡∏ì‡∏ó‡∏ò‡∏ô‡∏û‡∏ü‡∏†‡∏°‡∏¢‡∏£‡∏•‡∏ß‡∏¨‡∏Æ‡∏Ç‡∏É‡∏â‡∏ê‡∏ñ‡∏ú‡∏ù‡∏®‡∏©‡∏™‡∏´'; //alphabet classic groups
const THa='‡∏Å‡∏Ç‡∏É‡∏Ñ‡∏Ö‡∏Ü‡∏á‡∏à‡∏â‡∏ä‡∏ã‡∏å‡∏ç‡∏è‡∏ê‡∏ë‡∏é‡∏î‡∏í‡∏ì‡∏ï‡∏ñ‡∏ó‡∏ò‡∏ô‡∏ö‡∏õ‡∏ú‡∏ù‡∏û‡∏ü‡∏†‡∏°‡∏¢‡∏£‡∏•‡∏ß‡∏®‡∏©‡∏™‡∏´‡∏¨‡∏≠‡∏Æ‡∏§‡∏¶';
const TLa='·®†·®°·®¢·®£·®§·®•·®¶·®ß·®®·®©·®™·®´·®¨·®≠·®Æ·®Ø·®∞·®±·®≤·®≥·®¥·®µ·®∂·®∑·®∏·®π·®∫·®ª·®º·®Ω·®æ·®ø·©Ä·©Å·©Ç·©É·©Ñ·©Ö·©Ü·©á·©à·©â·©ä·©ã·©å·©ç·©é·©è'; //Tai Lanna
//TLa equiv. THa but with ‡∫ç=‡∏ç, ·©Ä=‡∏≠‡∏¢/‡∏´‡∏¢ -- ‡∏¢‡∏≤ ‡∏≠‡∏¢‡πà‡∏≤ ‡∏¢‡πà‡∏≤=‡∏´‡∏ç‡πâ‡∏≤ ‡∏¢‡πâ‡∏≤ ‡∏´‡∏¢‡∏≤  ‡∏¢; ‡∏ç=nj/ny √± in Pali
//const LOx="‡∫Å‡∫Ç_‡∫Ñ_‡∫Ñ‡∫á‡∫à‡∫™‡∫ä_‡∫ä‡∫ç‡∫ï‡∫ñ‡∫ó‡∫î‡∫î‡∫ó‡∫ô‡∫ï‡∫ñ‡∫ó‡∫ó‡∫ô‡∫ö‡∫õ‡∫ú‡∫ù‡∫û‡∫ü‡∫û‡∫°‡∫ç‡∫£‡∫•‡∫ß‡∫™‡∫™‡∫™‡∫´‡∫•‡∫≠‡∫Æ--"; //Lo ‡∫ç=‡∏ç, ·©Ä=‡∏≠‡∏¢, no ‡∏§‡∏¶
const LOa='‡∫Å‡∫Ç‡∫Ñ‡∫á‡∫à‡∫™‡∫ä‡∫ç‡∫î‡∫ï‡∫ñ‡∫ó‡∫ô‡∫ö‡∫õ‡∫ú‡∫ù‡∫û‡∫ü‡∫°‡∫¢‡∫£‡∫•‡∫ß‡∫´‡∫≠‡∫Æ'; // Lao [lo] 28 chars
const THb='‡∏Å‡∏Ç‡∏Ñ‡∏á‡∏à‡∏™‡∏ã‡∏ç‡∏î‡∏ï‡∏ñ‡∏ó‡∏ô‡∏ö‡∏õ‡∏ú‡∏ù‡∏û‡∏ü‡∏°‡∏¢‡∏£‡∏•‡∏ß‡∏´‡∏≠‡∏Æ'; // '‡∏â‡∏é‡∏è‡∏ê‡∏ë‡∏í‡∏ì‡∏ò‡∏†‡∏®‡∏©‡∏¨'excluded
const KHa="·ûÄ·ûÅ_·ûÇ_·ûÉ·ûÑ·ûÖ·ûÜ·ûá_·ûà·ûâ·ûä·ûã·ûå·ûç·ûé·ûè·ûê·ûë·ûí·ûì·ûî_·ûï_·ûñ_·ûó·ûò·ûô_·ûö·ûõ·ûú·ûù·ûû·ûü·û†·û°·û¢_·û´·û≠"; // KH no ‡∏Æ, yes ‡∏§‡∏¶
const MMa="·ÄÄ·ÄÅ_·ÄÇ_·ÄÉ·ÄÑ·ÄÖ·ÄÜ·Äá_·Äà·Ää·Äã·Äå·Äç·Äé·Äè·Äê·Äë·Äí·Äì·Äî·Äï_·Äñ_·Äó_·Äò·Äô·Äö_·Äõ·Äú·Äù·Åê·Åë·Äû·Äü·Ä†·Ä°_·Åí·Åî"; // MN no ‡∏Æ, yes ‡∏§‡∏¶

function shuffle(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = arr[i];
    arr[i] = arr[j];
    arr[j] = temp;
  }
  return arr;
}
var _anonfn = function (e) { hideshow(this); }; // for removeEventListener

function deal() {
  if (reload==0) {reload=1;} 
  else {
    // clear the mem cards then reload
    const cds = document.getElementById("board");
    while (cds.hasChildNodes()) {
      cds.removeChild(cds.firstChild);
    }
    location.reload(); 
    msg.innerText="OK, ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å?";
  }
  
  mask = shuffle(masks)[0]; // choose a cover
  xgame = document.getElementById("xmode").value;
  //***Google Chrome resets to 1st option on reload -- must reselect***
  //var xgame = xmode.options[xmode.selectedIndex].value;
  // set query array and its twin array (of equivalent Thai chars)
  switch (xgame) {
    case "emo" : query = Emos; twin = query; break;  
    case "‡∏Å‡∏Ç‡∏Ñ": query = Array.from(THa); twin = query; break;
    case "·®†·®°‡∏Ñ": query = Array.from(TLa); twin = Array.from(THa); break;
    case "‡∫Å=‡∏Å": query = Array.from(LOa); twin = Array.from(THb); break;
    case "·ûÄ=‡∏Å": query = Array.from(KHa); twin = Array.from(THa); break; 
    case "·ÄÄ=‡∏Å": query = Array.from(MMa); twin = Array.from(THa); break; 
    case "·®†·®°·®¢": query = Array.from(TLa); twin = query; break;
    case "abc" : query = Array.from(Lat); twin = query; break; 
  }

  var qrnd = [...Array(query.length).keys()]
             .sort(function(){return 0.5 - Math.random()}); // index array
  var n8 = qrnd.slice(0,8); //select 8 query positions
  
  // fill query and twin chars
  var q8 = [], t8 = []; // query and its twin chars in THa 
  if (["‡∫Å=‡∏Å","·®†·®°‡∏Ñ","·ûÄ=‡∏Å","·ÄÄ=‡∏Å"].indexOf(xgame)>-1) {
    for (var i=0; i<8; i++) {
      // handle char "_" replacing it with next unselected 
      if (query[n8[i]]=="_") {
        //console.log("_ found: for "+n8[i]+" at i="+i);
        var g = n8[i];
        for (var s=0;s<5;s++) {
          g++; if (g>query.length) g -=query.length;
          //console.log("**g="+g+" q="+query[g]+" n8="+n8);
          if (!(query[g]=="_") && (n8.indexOf(g)==-1)) {
            n8[i] = g;
            //console.log("<<replaced n8["+i+"]= "+g+" ="+query[g]);
            break;
          } else continue;
        } 
        //console.log(i+" "+n8[i]+" ="+query[n8[i]]);
      }   
      //console.log(i+" "+n8[i]+" ="+query[n8[i]]);

      q8[i] = query[n8[i]]; // Query letter
      t8[i] = twin[n8[i]];  // corresp THa letter
      //console.log("i="+i+" at="+n8[i]+" q="+query[n8[i]]+" t="+twin[n8[i]]);
    } 
    //console.log("n8="+n8+" q8="+q8+" t8="+t8);
    quiz = shuffle([...q8, ...t8]); // mixed query and twin cards
  } else {
    for (var i=0; i<8; i++) {
     q8[i] = query[n8[i]];  // corresp query letter
    }
    quiz = shuffle([...q8, ...q8]); // double and shuffle -->quiz
  }
  //console.log("After doubled & shuffled "+ quiz);

  for(var i=0;i<4;i++){ //row
    for(var j=0;j<4;j++){ //column
      var card = document.createElement('div'); //create a card
      card.className = 'card';
      var t = 4*i+j;
      card.innerText = mask; //thc[t]; // cover the face value
      //card.addEventListener("click", function (e) { hideshow(this); });
      card.addEventListener("click", _anonfn);
      board.appendChild(card); // add to board
      cards[t] = card; // save card object  
    }
  }
}

function ismatched(xgame) {
  if (["‡∫Å=‡∏Å","·®†·®°‡∏Ñ","·ûÄ=‡∏Å","·ÄÄ=‡∏Å"].indexOf(xgame)>-1) {
    var cit = twin.indexOf(quiz[cix]); // -1:not in twin; else pos 
    var ciq = query.indexOf(quiz[cix]);
    //matched if a query card with the same position as opened card
    //matched if a twin  card with the same position as opened card 
    if ( ( (cit>-1) && (cit==query.indexOf(quiz[oix])) ) ||
       ( (ciq>-1) && (ciq==twin.indexOf(quiz[oix])) ) ) return true; 
     else return false;
  } else if (quiz[oix]==quiz[cix]) return true;
         else return false; 
}

function hideshow(e) {
  cix = cards.indexOf(e); // card position in cards
  e.innerText = quiz[cix]; // display face value
  var matched=false, ciq, cit; // card in query, in twin
  //console.log("This card is " +quiz[cix]);

  if (opened==null) {
    //console.log("No other card opened ");
    opened = e; // save it and its index
    oix = cix;
    e.innerText = quiz[oix]; // show its face
    e.style.opacity==1.0;   
  } else { // a card is already opened -- do matching
    //console.log("  this card is "+quiz[cix]+" already opened "+quiz[oix]);
    if (e==opened) { //already opened --> toggle close it
      e.innerText = mask; // cover its face
      e.style.opacity==0.7; // take off spotlight
      opened=null; oix = null; // reset oix too?      
      //console.log(" click on opened card -- close it");
    } else if (ismatched(xgame)) { // a match on face/position value
      //console.log("a match --remove both cards from board");
      clearTimeout(toid);
      toid = setTimeout(function () {
        ping(1); // acknowledge a match
        e.innerText = tick; 
        opened.innerText = tick; // tick out
        e.style.animation = 'none'; 
        e.removeEventListener("click", _anonfn);
        opened.style.animation = 'none';
        opened.removeEventListener("click", _anonfn);
        msg.innerText = "Yes! "+quiz[oix]+"="+quiz[cix];
        pairs.innerText += " "+quiz[oix]+"="+quiz[cix];
        opened = null; oix = null;    
        }, 650);
      
      npairs++;
      if (npairs>=8){
        ping(2); // say "end game"
        msg.innerText = "‡πÑ‡∏ä‡πÇ‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß"; 
        clearTimeout(toid);
        toid = setTimeout(function () {
          msg.innerText = "‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å?";
        }, 1000);
      }
    } else { // handle mismatch
      //console.log("mismatch "+quiz[oix]+" != "+quiz[cix]+ " close both cards");
      clearTimeout(toid);
      toid = setTimeout(function () {
        ping(0);
        e.innerText = mask; //close the card
        cards[oix].innerText = mask;
        opened=null; 
        oix = null;
        msg.innerText = "..no?";
      }, 800);
    }
  }
}

function ping(yn) {
  //set beep freq by the musical notes
  //var notes=[256.87, 272.14, 288.33, 305.47, 323.63, 342.88, 363.27, 384.87, 407.75, 432.00, 457.69, 484.90];
  if (yn==1) {
    beep2(432.0,1,0.4,250, 457.89,2,0.4,125); 
  } else if (yn==0) { 
    beep2(128.43,2,0.3,250, 256.9,1,0.3,125); 
  } else {
    //end game play a few notes
    beep2(256.0,1,0.4,500, 256.9,2,0.4,500);
    clearTimeout(toid);
    toid = setTimeout(function () {
      beep2(432.0,2,0.4,250, 432.0,1,0.4,250);
      }, 125);
    clearTimeout(toid);
    toid = setTimeout(function () {
      beep2(969.8,1,0.4,750, 969.8,1,0.4,500);
      }, 250);
  }
}
</script>

</body>
</html>
